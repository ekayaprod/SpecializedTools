(function () {
    const D = [["Adams", 17301, 17372, ["Gettysburg", "Littlestown", "McSherrystown", "New Oxford", "Bonneauville", "Carroll Valley", "East Berlin", "Fairfield", "York Springs", "Arendtsville", "Bendersville"]], ["Allegheny", 15101, 15295, ["Pittsburgh", "McKeesport", "Clairton", "Duquesne", "Bethel Park", "Monroeville", "Mount Lebanon", "Penn Hills", "West Mifflin", "Baldwin", "Franklin Park", "Jefferson Hills", "Moon", "Plum", "Shaler", "Upper St. Clair", "Whitehall", "Allison Park", "Glenshaw", "Wexford", "Gibsonia", "Bridgeville", "Carnegie", "Castle Shannon", "Coraopolis", "Crafton", "Dormont", "Edgewood", "Forest Hills", "Glassport", "Green Tree", "Ingram", "McKees Rocks", "Munhall", "Oakmont", "Pitcairn", "Pleasant Hills", "Sewickley", "Swissvale", "Tarentum", "Verona", "West View", "Wilkinsburg", "Aspinwall", "Avalon", "Bell Acres", "Bellevue", "Ben Avon", "Braddock", "Braddock Hills", "Chalfant", "Churchill", "Dravosburg", "East McKeesport", "East Pittsburgh", "Edgeworth", "Emsworth", "Etna", "Fox Chapel", "Heidelberg", "Homestead", "Leetsdale", "Millvale", "Mount Oliver", "North Braddock", "Rankin", "Sharpsburg", "Springdale", "Stowe", "Thornburg", "Trafford", "Turtle Creek", "Wall", "West Homestead", "Whitaker", "Wilmerding"]], ["Armstrong", 15610, 15688, ["Kittanning", "Ford City", "Leechburg", "Apollo", "Freeport", "Parker", "Rural Valley", "South Bethlehem"]], ["Beaver", 15001, 15099, ["Beaver Falls", "Aliquippa", "Ambridge", "Monaca", "New Brighton", "Baden", "Beaver", "Bridgewater", "Conway", "Darlington", "East Rochester", "Eastvale", "Economy", "Fallston", "Freedom", "Georgetown", "Glasgow", "Homewood", "Hookstown", "Industry", "Koppel", "Midland", "New Galilee", "Ohioville", "Patterson Heights", "Rochester", "Shippingport", "South Heights", "West Mayfield"]], ["Bedford", 15522, 15583, ["Bedford", "Everett", "Coaldale", "Hyndman", "Manns Choice", "New Paris", "Pleasantville", "Rainsburg", "Saxton", "Schellsburg", "St. Clairsville", "Woodbury"]], ["Berks", 19501, 19640, ["Reading", "Wyomissing", "Pottstown", "Sinking Spring", "Shillington", "Birdsboro", "Kutztown", "Hamburg", "Boyertown", "Bally", "Bechtelsville", "Bernville", "Centerport", "Fleetwood", "Kenhorst", "Laureldale", "Leesport", "Lenhartsville", "Lyons", "Mohnton", "Mount Penn", "New Morgan", "Robesonia", "Shoemakersville", "St. Lawrence", "Strausstown", "Temple", "Topton", "Wernersville", "West Reading"]], ["Blair", 16601, 16693, ["Altoona", "Hollidaysburg", "Tyrone", "Bellwood", "Duncansville", "Martinsburg", "Newry", "Roaring Spring", "Williamsburg"]], ["Bradford", 16901, 16950, ["Sayre", "Towanda", "Athens", "Troy", "Alba", "Burlington", "Canton", "Leraysville", "Monroe", "New Albany", "Rome", "Sylvania", "Wyalusing"]], ["Bucks", 18901, 19090, ["Levittown", "Bensalem", "Bristol", "Doylestown", "Quakertown", "Warminster", "Newtown", "Morrisville", "Perkasie", "Sellersville", "Yardley", "Langhorne", "Feasterville-Trevose", "Richboro", "Chalfont", "Dublin", "Hulmeville", "Ivyland", "Langhorne Manor", "New Britain", "New Hope", "Penndel", "Richlandtown", "Riegelsville", "Silverdale", "Telford", "Trumbauersville", "Tullytown"]], ["Butler", 16001, 16137, ["Butler", "Cranberry", "Slippery Rock", "Zelienople", "Mars", "Seven Fields", "Bruin", "Callery", "Cherry Valley", "Chicora", "Connoquenessing", "East Butler", "Eau Claire", "Evans City", "Fairview", "Harmony", "Harrisville", "Karns City", "Petrolia", "Portersville", "Prospect", "Saxonburg", "Valencia", "West Liberty", "West Sunbury"]], ["Cambria", 15901, 15958, ["Johnstown", "Ebensburg", "Windber", "Portage", "Nanty Glo", "Ashville", "Barnesboro", "Brownstown", "Carrolltown", "Cassandra", "Chest Springs", "Cresson", "Daisytown", "Dale", "East Conemaugh", "Ferndale", "Franklin", "Gallitzin", "Geistown", "Hastings", "Lilly", "Lorain", "Loretto", "Patton", "Sankertown", "Scalp Level", "South Fork", "Southmont", "Spangler", "Summerhill", "Tunnelhill", "Vintondale", "Westmont", "Wilmore"]], ["Carbon", 18210, 18252, ["Lehighton", "Jim Thorpe", "Palmerton", "Lansford", "Beaver Meadows", "Bowmanstown", "East Side", "Nesquehoning", "Parryville", "Summit Hill", "Weatherly", "Weissport"]], ["Centre", 16801, 16877, ["State College", "Bellefonte", "Philipsburg", "Boalsburg", "Centre Hall", "Howard", "Milesburg", "Millheim", "Port Matilda", "Snow Shoe", "Unionville"]], ["Chester", 19301, 19395, ["West Chester", "Phoenixville", "Coatesville", "Downingtown", "Kennett Square", "Paoli", "Exton", "Atglen", "Avondale", "Elverson", "Honey Brook", "Malvern", "Modena", "Oxford", "Parkesburg", "South Coatesville", "Spring City"]], ["Clarion", 16201, 16374, ["Clarion", "New Bethlehem", "Callensburg", "East Brady", "Foxburg", "Hawthorn", "Knox", "Rimersburg", "Shippenville", "Sligo", "St. Petersburg", "Strattanville"]], ["Clearfield", 15826, 16865, ["DuBois", "Clearfield", "Philipsburg", "Curwensville", "Brisbin", "Burnside", "Chester Hill", "Coalport", "Glen Hope", "Grampian", "Houtzdale", "Irvona", "Lumber City", "Mahaffey", "New Washington", "Newburg", "Osceola Mills", "Ramey", "Troutville", "Wallaceton", "Westover"]], ["Clinton", 17720, 17779, ["Lock Haven", "Mill Hall", "Avis", "Beech Creek", "Flemington", "Loganton", "Renovo", "South Renovo"]], ["Columbia", 17801, 17889, ["Bloomsburg", "Berwick", "Ashland", "Benton", "Briar Creek", "Catawissa", "Centralia", "Millville", "Orangeville", "Stillwater"]], ["Crawford", 16301, 16436, ["Meadville", "Titusville", "Conneaut Lake", "Blooming Valley", "Cambridge Springs", "Canadohta Lake", "Centerville", "Cochranton", "Conneautville", "Geneva", "Hartstown", "Hydetown", "Linesville", "Saegertown", "Spartansburg", "Springboro", "Townville", "Venango", "Woodcock"]], ["Cumberland", 17011, 17070, ["Carlisle", "Mechanicsburg", "Camp Hill", "New Cumberland", "Shippensburg", "Lemoyne", "Enola", "Mount Holly Springs", "Newburg", "Newville", "Shiremanstown", "West Fairview", "Wormleysburg"]], ["Dauphin", 17001, 17113, ["Harrisburg", "Hershey", "Middletown", "Hummelstown", "Steelton", "Elizabethville", "Berrysburg", "Dauphin", "Gratz", "Halifax", "Highspire", "Lykens", "Millersburg", "Paxtang", "Penbrook", "Pillow", "Royalton", "Williamstown"]], ["Delaware", 19013, 19094, ["Chester", "Upper Darby", "Haverford", "Radnor", "Drexel Hill", "Media", "Springfield", "Ridley Park", "Wayne", "Aldan", "Brookhaven", "Clifton Heights", "Collingdale", "Colwyn", "Darby", "East Lansdowne", "Eddystone", "Folcroft", "Glenolden", "Lansdowne", "Marcus Hook", "Millbourne", "Morton", "Norwood", "Parkside", "Prospect Park", "Rose Valley", "Rutledge", "Sharon Hill", "Swarthmore", "Trainer", "Upland", "Yeadon"]], ["Elk", 15834, 15866, ["St. Marys", "Ridgway", "Johnsonburg"]], ["Erie", 16401, 16565, ["Erie", "Corry", "Edinboro", "North East", "Girard", "Albion", "Cranesville", "East Springfield", "Elgin", "Fairview", "Lake City", "McKean", "Mill Village", "Platea", "Union City", "Waterford", "Wattsburg", "Wesleyville"]], ["Fayette", 15401, 15490, ["Uniontown", "Connellsville", "Brownsville", "Masontown", "Belle Vernon", "Dawson", "Dunbar", "Everson", "Fairchance", "Fayette City", "Markleysburg", "Newell", "Ohiopyle", "Perryopolis", "Point Marion", "Smithfield", "South Connellsville", "Vanderbilt"]], ["Franklin", 17201, 17268, ["Chambersburg", "Waynesboro", "Greencastle", "Mercersburg", "Mont Alto", "Orrstown"]], ["Greene", 15301, 15370, ["Waynesburg", "Carmichaels", "Clarksville", "Greensboro", "Jefferson", "Rices Landing"]], ["Huntingdon", 16652, 17066, ["Huntingdon", "Mount Union", "Alexandria", "Birmingham", "Broad Top City", "Cassville", "Coalmont", "Dudley", "Mapleton", "Marklesburg", "Mill Creek", "Orbisonia", "Petersburg", "Rockhill", "Saltillo", "Shade Gap", "Shirleysburg", "Three Springs"]], ["Indiana", 15701, 15781, ["Indiana", "Blairsville", "Armagh", "Cherry Tree", "Clarksburg", "Clymer", "Creekside", "Ernest", "Glen Campbell", "Homer City", "Jacksonville", "Marion Center", "Plumville", "Saltsburg", "Shelocta", "Smicksburg"]], ["Jefferson", 15831, 15866, ["Punxsutawney", "Brookville", "Reynoldsville", "Big Run", "Brockway", "Corsica", "Falls Creek", "Summerville", "Sykesville", "Timblin", "Worthville"]], ["Juniata", 17020, 17099, ["Mifflintown", "Mifflin", "Port Royal", "Thompsontown"]], ["Lackawanna", 18401, 18519, ["Scranton", "Carbondale", "Dunmore", "Old Forge", "Clarks Summit", "Archbald", "Dickson City", "Blakely", "Clarks Green", "Dalton", "Jermyn", "Jessup", "Mayfield", "Moosic", "Moscow", "Olyphant", "Taylor", "Throop", "Vandling", "Waverly"]], ["Lancaster", 17501, 17608, ["Lancaster", "Ephrata", "Elizabethtown", "Lititz", "Columbia", "Manheim", "New Holland", "Akron", "Christiana", "Denver", "East Petersburg", "Marietta", "Millersville", "Mount Joy", "Mountville", "Quarryville", "Strasburg", "Terre Hill"]], ["Lawrence", 16101, 16160, ["New Castle", "Ellwood City", "New Wilmington", "Bessemer", "Enon Valley", "New Beaver", "S.N.P.J.", "South New Castle", "Volant", "Wampum"]], ["Lebanon", 17003, 17099, ["Lebanon", "Palmyra", "Annville", "Myerstown", "Cleona", "Cornwall", "Jonestown", "Richland"]], ["Lehigh", 18001, 18109, ["Allentown", "Bethlehem", "Emmaus", "Whitehall", "Macungie", "Alburtis", "Catasauqua", "Coopersburg", "Coplay", "Fountain Hill", "Slatington"]], ["Luzerne", 18201, 18709, ["Wilkes-Barre", "Hazleton", "Kingston", "Nanticoke", "Pittston", "Mountain Top", "Dallas", "Ashley", "Avoca", "Bear Creek Village", "Conyngham", "Courtdale", "Dupont", "Duryea", "Edwardsville", "Exeter", "Forty Fort", "Freeland", "Harveys Lake", "Hughestown", "Jeddo", "Laflin", "Larksville", "Laurel Run", "Luzerne", "New Columbus", "Nuangola", "Penn Lake Park", "Plymouth", "Pringle", "Shickshinny", "Sugar Notch", "Swoyersville", "Warrior Run", "West Hazleton", "West Pittston", "West Wyoming", "White Haven", "Wyoming", "Yatesville"]], ["Lycoming", 17701, 17778, ["Williamsport", "Montoursville", "Muncy", "Jersey Shore", "Duboistown", "Hughesville", "Montgomery", "Picture Rocks", "Salladasburg", "South Williamsport"]], ["McKean", 16701, 16749, ["Bradford", "Kane", "Eldred", "Lewis Run", "Mount Jewett", "Port Allegany", "Smethport"]], ["Mercer", 16125, 16173, ["Hermitage", "Sharon", "Greenville", "Grove City", "Mercer", "Clark", "Farrell", "Fredonia", "Jackson Center", "Jamestown", "New Lebanon", "Sandy Lake", "Sheakleyville", "Stoneboro", "West Middlesex", "Wheatland"]], ["Mifflin", 17044, 17099, ["Lewistown", "Burnham", "Juniata Terrace", "Kistler", "McVeytown", "Newton Hamilton"]], ["Monroe", 18301, 18372, ["East Stroudsburg", "Stroudsburg", "Mount Pocono", "Pocono Pines", "Delaware Water Gap"]], ["Montgomery", 19001, 19490, ["Norristown", "Pottstown", "King of Prussia", "Lansdale", "Willow Grove", "Horsham", "Montgomeryville", "Ardmore", "Harleysville", "Ambler", "Bridgeport", "Bryn Athyn", "Collegeville", "Conshohocken", "East Greenville", "Green Lane", "Hatboro", "Hatfield", "Jenkintown", "Narberth", "North Wales", "Pennsburg", "Red Hill", "Rockledge", "Royersford", "Schwenksville", "Souderton", "Trappe", "West Conshohocken"]], ["Montour", 17821, 17889, ["Danville", "Washingtonville"]], ["Northampton", 18013, 18109, ["Bethlehem", "Easton", "Northampton", "Nazareth", "Bangor", "Bath", "Chapman", "East Bangor", "Freemansburg", "Glendon", "Hellertown", "North Catasauqua", "Pen Argyl", "Portland", "Roseto", "Stockertown", "Tatamy", "Walnutport", "West Easton", "Wilson", "Wind Gap"]], ["Northumberland", 17801, 17889, ["Sunbury", "Shamokin", "Mount Carmel", "Milton", "Herndon", "Kulpmont", "Marion Heights", "McEwensville", "Northumberland", "Riverside", "Snydertown", "Turbotville", "Watsontown"]], ["Perry", 17013, 17099, ["Newport", "Duncannon", "Blain", "Bloomfield", "Landisburg", "Liverpool", "Marysville", "New Buffalo"]], ["Philadelphia", 19101, 19155, ["Philadelphia"]], ["Pike", 18324, 18472, ["Milford", "Matamoras"]], ["Potter", 16915, 16950, ["Coudersport", "Austin", "Galeton", "Oswayo", "Shinglehouse", "Ulysses"]], ["Schuylkill", 17901, 17985, ["Pottsville", "Tamaqua", "Schuylkill Haven", "Shenandoah", "Mahanoy City", "Ashland", "Auburn", "Coaldale", "Cressona", "Deer Lake", "Frackville", "Gilberton", "Girardville", "Gordon", "Landingville", "McAdoo", "Mechanicsville", "Middleport", "Minersville", "Mount Carbon", "New Philadelphia", "New Ringgold", "Orwigsburg", "Palo Alto", "Pine Grove", "Port Carbon", "Port Clinton", "Ringtown", "St. Clair", "Tower City", "Tremont"]], ["Snyder", 17837, 17889, ["Selinsgrove", "Middleburg", "Beavertown", "Freeburg", "McClure", "Shamokin Dam"]], ["Somerset", 15501, 15563, ["Somerset", "Windber", "Meyersdale", "Addison", "Benson", "Berlin", "Boswell", "Callimont", "Casselman", "Central City", "Confluence", "Garrett", "Hooversville", "Indian Lake", "Jennerstown", "New Baltimore", "New Centerville", "Paint", "Rockwood", "Salisbury", "Shanksville", "Stoystown", "Ursina", "Wellersburg"]], ["Susquehanna", 18801, 18853, ["Montrose", "Forest City", "Friendsville", "Great Bend", "Hallstead", "Hop Bottom", "Lanesboro", "Little Meadows", "New Milford", "Oakland", "Susquehanna Depot", "Thompson", "Union Dale"]], ["Tioga", 16920, 16950, ["Wellsboro", "Mansfield", "Blossburg", "Covington", "Elkland", "Knoxville", "Lawrenceville", "Liberty", "Middlebury Center", "Millerton", "Morris", "Osceola", "Roseville", "Tioga", "Westfield"]], ["Union", 17837, 17889, ["Lewisburg", "Mifflinburg", "Hartleton", "New Berlin"]], ["Venango", 16301, 16374, ["Oil City", "Franklin", "Titusville", "Barkeyville", "Clintonville", "Cooperstown", "Emlenton", "Pleasantville", "Polk", "Rouseville", "Sugarcreek", "Utica"]], ["Warren", 16301, 16374, ["Warren", "Bear Lake", "Clarendon", "Sugar Grove", "Tidioute", "Youngsville"]], ["Washington", 15301, 15370, ["Washington", "Canonsburg", "Monongahela", "Charleroi", "McMurray", "Allenport", "Beallsville", "Bentleyville", "Burgettstown", "California", "Canton", "Cecil-Bishop", "Centerville", "Claysville", "Coal Center", "Cokeburg", "Deemston", "Donora", "Dunlevy", "East Washington", "Elco", "Ellsworth", "Finleyville", "Green Hills", "Houston", "Long Branch", "Marianna", "McDonald", "Midway", "New Eagle", "North Charleroi", "North Franklin", "Roscoe", "Speers", "Stockdale", "Twilight", "West Brownsville", "West Middletown"]], ["Wayne", 18411, 18472, ["Honesdale", "Hawley", "Bethany", "Prompton", "Starrucca", "Waymart"]], ["Westmoreland", 15601, 15697, ["Greensburg", "Murrysville", "New Kensington", "Latrobe", "Lower Burrell", "Jeannette", "Monessen", "Irwin", "Adamsburg", "Arona", "Avonmore", "Bolivar", "Delmont", "Derry", "Donegal", "East Vandergrift", "Export", "Hunker", "Hyde Park", "Ligonier", "Madison", "Manor", "Mount Pleasant", "New Alexandria", "New Florence", "New Stanton", "North Belle Vernon", "North Irwin", "Oklahoma", "Penn", "Scottdale", "Seward", "Smithton", "South Greensburg", "Southwest Greensburg", "Sutersville", "Trafford", "Vandergrift", "West Leechburg", "West Newton", "Youngstown", "Youngwood"]], ["Wyoming", 18610, 18657, ["Tunkhannock", "Factoryville", "Laceyville", "Meshoppen", "Nicholson"]], ["York", 17401, 17408, ["York", "Hanover", "Red Lion", "Shrewsbury", "Dillsburg", "Cross Roads", "Dallastown", "Delta", "Dover", "East Prospect", "Fawn Grove", "Felton", "Franklintown", "Glen Rock", "Goldsboro", "Hallam", "Jacobus", "Jefferson", "Lewisberry", "Loganville", "Manchester", "Mount Wolf", "New Freedom", "New Salem", "North York", "Railroad", "Seven Valleys", "Spring Grove", "Stewartstown", "Wellsville", "West York", "Windsor", "Winterstown", "Wrightsville", "Yoe", "Yorkana", "York Haven"]]];
    /* Note: Full list extracted from original index.html */

    const O = {"bethlehem": {"Lehigh": [18015, 18017], "Northampton": [18016, 18018, 18020, 18025]}, "trafford": {"Allegheny": [15085], "Westmoreland": [15085]}, "mcdonald": {"Allegheny": [15057], "Washington": [15057]}, "ellwood city": {"Beaver": [16117], "Lawrence": [16117]}, "adamstown": {"Berks": [19501], "Lancaster": [19501]}, "shippensburg": {"Cumberland": [17257], "Franklin": [17257]}, "seven springs": {"Fayette": [15622], "Somerset": [15622]}};

    function find(q) {
        const c = q.trim();
        const results = [];

        /* ZIP SEARCH */
        if (/^\d{5}$/.test(c)) {
            const z = parseInt(c, 10);

            /* D Ranges */
            for (let i = 0; i < D.length; i++) {
                if (z >= D[i][1] && z <= D[i][2]) {
                    if (!results.includes(D[i][0])) results.push(D[i][0]);
                }
            }

            /* O Specifics */
            for (const city in O) {
                const counties = O[city];
                for (const county in counties) {
                    if (counties[county].includes(z)) {
                        if (!results.includes(county)) results.push(county);
                    }
                }
            }
            return results.length ? c + ': ' + results.join(', ') : null;
        }

        /* CITY SEARCH */
        const l = c.toLowerCase();

        /* D Search */
        for (let i = 0; i < D.length; i++) {
            const cities = D[i][3];
            for (let j = 0; j < cities.length; j++) {
                if (cities[j].toLowerCase() === l) {
                    if (!results.includes(D[i][0])) results.push(D[i][0]);
                    break;
                }
            }
        }

        return results.length ? c + ': ' + results.join(', ') : null;
    }

    /* UI LOGIC */
    const overlay = document.createElement('div');
    Object.assign(overlay.style, {position:'fixed',inset:0,background:'rgba(0,0,0,0.5)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:99999});
    const card = document.createElement('div');
    Object.assign(card.style, {background:'white',padding:'20px',borderRadius:'8px',boxShadow:'0 10px 25px rgba(0,0,0,0.2)',width:'300px',fontFamily:'system-ui'});
    card.innerHTML = `<h3 style="margin:0 0 15px">PA County Finder</h3><div id="pa-content"></div>`;
    overlay.appendChild(card);
    overlay.onclick = e => e.target === overlay && overlay.remove();

    const content = card.querySelector('#pa-content');
    const showRes = (r, q) => {
        content.innerHTML = r ? `<div style="color:#15803d;background:#dcfce7;padding:12px;border-radius:6px;margin-bottom:10px"><strong>Found:</strong><br>${r}</div>`
                              : `<div style="color:#b91c1c;background:#fee2e2;padding:12px;border-radius:6px;margin-bottom:10px">No match for "<strong>${q}</strong>"</div>`;
        const close = document.createElement('button');
        close.textContent = 'Close';
        Object.assign(close.style, {width:'100%',padding:'8px',background:'#f3f4f6',border:'none',borderRadius:'4px',cursor:'pointer'});
        close.onclick = () => overlay.remove();
        content.appendChild(close);
    };

    let s = window.getSelection().toString().trim();
    if (s) {
        showRes(find(s), s);
    } else {
        const inp = document.createElement('input');
        Object.assign(inp.style, {width:'100%',padding:'10px',marginBottom:'10px',boxSizing:'border-box',border:'1px solid #ccc',borderRadius:'4px'});
        inp.placeholder = "Enter ZIP or City";
        const btn = document.createElement('button');
        btn.textContent = 'Search';
        Object.assign(btn.style, {width:'100%',padding:'10px',background:'#2563eb',color:'white',border:'none',borderRadius:'4px',cursor:'pointer',fontWeight:'bold'});
        btn.onclick = () => { if(inp.value.trim()) showRes(find(inp.value.trim()), inp.value.trim()); };
        inp.onkeydown = e => e.key === 'Enter' && btn.click();
        content.append(inp, btn);
        setTimeout(() => inp.focus(), 50);
    }
    document.body.appendChild(overlay);
})();